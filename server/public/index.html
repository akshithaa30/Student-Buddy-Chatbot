<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Student Buddy Chatbot</title>
  <link rel="manifest" href="/manifest.json">
  <link rel="icon" href="/assets/logo.svg">
  <meta name="theme-color" content="#0ea5e9" />

  <!-- üîí Redirect if not logged in -->
  <script>
    if (!localStorage.getItem("token")) {
      window.location.href = "login.html";
    }
  </script>

  <style>
    :root{
      --bg:#000;
      --card:#111827;
      --muted:#94a3b8;
      --accent:#0ea5e9;
      --accent-2:#22d3ee;
      --text:#e5e7eb;
      --bubble:#1f2937;
      --user:#0ea5e920;
      --ok:#10b981;
      --warn:#fbbf24;
      --danger:#ef4444;
    }
    *{ box-sizing:border-box }
    body{
      margin:0; font-family: ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto;
      background: var(--bg);
      color:var(--text);
    }
    header{
      display:flex; align-items:center; gap:.7rem; padding:12px 16px; position:sticky; top:0;
      background:linear-gradient(180deg, rgba(11,18,32,.9), rgba(11,18,32,.7) 60%, transparent);
      backdrop-filter: blur(8px); border-bottom:1px solid #01070c;
      z-index:50;
    }
    header img{ width:28px; height:28px }
    header .title{ font-weight:700; letter-spacing:.3px }
    .logout-btn {
      margin-left:10px;
      padding:6px 12px;
      border:none;
      border-radius:8px;
      background:linear-gradient(90deg, var(--accent), var(--accent-2));
      color:#001018;
      font-weight:700;
      cursor:pointer;
    }
    .logout-btn:hover {
      opacity:0.9;
      transform:translateY(-1px);
    }
    .container{ display:grid; grid-template-columns: 320px 1fr; gap:16px; padding:16px; }
    @media (max-width: 900px){ .container{ grid-template-columns: 1fr } }
    .panel{ background:linear-gradient(180deg, #0b1220, #0b1220dd 70%, #0b1220c0); border:1px solid #1f2937; border-radius:16px; overflow:hidden; }
    .tools{ padding:16px; display:grid; gap:12px }
    .tools h3{ margin:0 0 6px 0; font-size:14px; color:var(--muted); text-transform:uppercase; letter-spacing:.1em }
    .chip-row{ display:flex; flex-wrap:wrap; gap:8px }
    .chip{
      padding:8px 12px; border-radius:999px; border:1px solid #1f2937; background:#0b1220; cursor:pointer;
      transition:.15s transform,.15s background;
    }
    .chip:hover{ transform:translateY(-1px); background:#0b1220cc }
    .switch{ display:flex; gap:8px }
    .switch button{
      flex:1; padding:8px 10px; border-radius:12px; border:1px solid #1f2937; background:#0b1220; color:var(--text); cursor:pointer;
    }
    .switch button.active{ background:linear-gradient(90deg, var(--accent), var(--accent-2)); border:0; color:#001018; font-weight:700 }
    .card{ padding:16px; border-top:1px dashed #1f2937 }
    .card h4{ margin:0 0 8px 0 }
    .actions{ display:flex; gap:8px; flex-wrap:wrap }
    .actions button{
      padding:10px 12px; border-radius:12px; border:1px solid #1f2937; background:linear-gradient(180deg, #111827, #0f172a);
      color:var(--text); cursor:pointer; transition:.15s transform;
    }
    .actions button:hover{ transform:translateY(-1px) }
    .chat{ display:flex; flex-direction:column; height:calc(100dvh - 120px); }
    .history{ flex:1; overflow:auto; padding:16px; display:flex; flex-direction:column; gap:10px }
    .bubble{
      max-width: 80%; padding:12px 14px; border-radius:16px; line-height:1.4;
      background: var(--bubble); border:1px solid #253045; box-shadow: 0 10px 30px rgba(2,8,23,.25);
      position: relative;
    }
    .bubble.user{ align-self:flex-end; background:var(--user); border-color:#1f3547 }
    .bubble .meta{ font-size:12px; color:var(--muted); margin-top:4px }
    .inputbar{ display:flex; gap:8px; padding:12px; border-top:1px solid #1f2937; background:#0b1220e6 }
    .inputbar input{
      flex:1; padding:14px 14px; border-radius:12px; border:1px solid #1f2937; background:#0b1220; color:var(--text);
    }
    .inputbar button{
      padding:12px 14px; border-radius:12px; background:linear-gradient(90deg, var(--accent), var(--accent-2)); color:#001018;
      font-weight:700; border:0; cursor:pointer;
    }
    .tiny{ font-size:12px; color:var(--muted) }
    .stack{ display:flex; flex-direction:column; gap:6px }
    .hidden{ display:none }
    .suggestions{ display:flex; gap:6px; flex-wrap:wrap; padding:0 16px 10px 16px }
    .suggestions button{ padding:8px 10px; border:1px dashed #1f2937; background:#0b1220; color:var(--text); border-radius:10px; cursor:pointer }
    .progress{ height:8px; background:#0b1220; border-radius:999px; border:1px solid #1f2937; overflow:hidden }
    .progress>div{ height:100%; width:0% ; background:linear-gradient(90deg, var(--ok), var(--warn)); transition: width .25s }
    footer{ padding:10px 16px; text-align:center; color:var(--muted) }
    a.link{ color: var(--accent) }
  </style>
</head>
<body>
  <header>
    <img src="/assets/logo.svg" alt="logo" />
    <div class="title">Student Buddy Chatbot</div>
    <div style="margin-left:auto" class="tiny">Persona:</div>
    <div class="switch" id="personaSwitch">
      <button data-p="friendly" class="active">Friendly</button>
      <button data-p="formal">Formal</button>
    </div>

    <!-- üö™ Logout Button -->
    <button onclick="logout()" class="logout-btn">Logout</button>
  </header>

  <div class="container">
    <aside class="panel">
      <div class="tools">
        <h3>Quick Actions</h3>
        <div class="chip-row">
          <div class="chip" data-insert="/help">/help</div>
          <div class="chip" data-insert="/calc (3+5)/2">/calc</div>
          <div class="chip" data-insert="/gpa 95,86,72|3,4,3">/gpa</div>
          <div class="chip" data-insert="/convert 180 cm ft">/convert</div>
          <div class="chip" data-insert="/todo list">/todo</div>
          <div class="chip" data-insert="/plan 7 DSA:2 OS:1 ML:3">/plan</div>
        </div>

        <div class="card">
          <h4>Pomodoro</h4>
          <div class="stack tiny">
            <div>Focus 25m ‚Ä¢ Break 5m</div>
            <div class="progress"><div id="pomoBar"></div></div>
            <div class="actions">
              <button id="startPomo">Start</button>
              <button id="stopPomo">Stop</button>
            </div>
          </div>
        </div>

        <div class="card">
          <h4>To-Dos</h4>
          <div class="stack tiny">
            <input id="todoInput" placeholder="Add a task..." />
            <div class="actions">
              <button id="addTodo">Add</button>
              <button id="listTodo">List</button>
              <button id="clearTodo">Clear</button>
            </div>
            <div id="todoList" class="tiny"></div>
          </div>
        </div>

        <div class="card">
          <h4>Voice</h4>
          <div class="actions">
            <button id="voiceBtn">üéôÔ∏è Speak</button>
            <button id="ttsBtn">üîä TTS</button>
          </div>
          <div class="tiny">Use voice input and text-to-speech for hands-free study.</div>
        </div>
      </div>
    </aside>

    <main class="panel chat">
      <div id="history" class="history"></div>
      <div id="suggestions" class="suggestions hidden"></div>
      <div class="inputbar">
        <input id="input" placeholder="Ask CHATBOT" />
        <button id="send">Send</button>
      </div>
      <footer class="tiny">
        Built with MongoDB ‚Ä¢ Express ‚Ä¢ Node and a modern HTML/CSS/JS frontend. 
        <a class="link" href="https://localhost:3000/api/health" target="_blank" rel="noreferrer">Health</a>
      </footer>
    </main>
  </div>

  <!-- üö™ Logout Function -->
  <script>
    function logout() {
      localStorage.removeItem("token");
      window.location.href = "login.html";
    }
  </script>

  <!-- Review widget -->
  <style>
    .review-widget { position: fixed; right: 20px; bottom: 20px; z-index: 200; font-family:inherit }
    .review-button { background: linear-gradient(90deg,#171718,#22d3ee); color:#001018; border:0; padding:10px 14px; border-radius:999px; cursor:pointer; box-shadow:0 10px 30px rgba(2,8,23,.35); display:flex; align-items:center; gap:8px; font-weight:800 }
    .review-badge { display:inline-block; background:rgba(0,0,0,0.12); padding:6px 8px; border-radius:999px; color:var(--text); font-weight:700; font-size:14px }
    .review-modal { position:fixed; right:20px; bottom:78px; width:320px; max-width:calc(100% - 40px); background:var(--card); border:1px solid #1f2937; border-radius:12px; padding:12px; box-shadow:0 12px 40px rgba(2,8,23,.55); transition:transform .18s ease, opacity .18s ease }
    .review-modal.hidden { transform: translateY(6px) scale(.99); opacity:0; pointer-events:none }
    .review-modal:not(.hidden) { transform:none; opacity:1; pointer-events:auto }
    .stars { display:flex; gap:6px; margin-top:8px }
    .stars button{ background:transparent; border:0; color:#fbbf24; font-size:22px; cursor:pointer; opacity:0.35; transition:opacity .12s }
    .stars button:hover{ opacity:1 }
    .review-list { max-height:180px; overflow:auto; margin-top:10px; font-size:13px }
    .review-item { border-top:1px dashed #1f2937; padding:8px 0 }
    @media (max-width:700px){ .review-modal{ right:10px; left:10px; bottom:90px; width:auto } }
  </style>

  <div class="review-widget" aria-hidden="false">
    <button id="openReview" class="review-button" aria-haspopup="dialog" aria-controls="reviewModal">Review <span id="reviewBadge" class="review-badge">0</span></button>
    <div id="reviewModal" class="review-modal hidden" role="dialog" aria-labelledby="reviewTitle">
      <div style="display:flex;justify-content:space-between;align-items:center"><strong id="reviewTitle">Rate this app</strong><button id="closeReview" aria-label="Close review" style="background:transparent;border:0;color:var(--muted);cursor:pointer">‚úï</button></div>
      <div style="margin-top:8px">
        <div class="stars" id="starRow">
          <button data-star="1" aria-label="1 star">‚òÖ</button>
          <button data-star="2" aria-label="2 stars">‚òÖ</button>
          <button data-star="3" aria-label="3 stars">‚òÖ</button>
          <button data-star="4" aria-label="4 stars">‚òÖ</button>
          <button data-star="5" aria-label="5 stars">‚òÖ</button>
        </div>
        <textarea id="reviewComment" placeholder="Leave a comment (optional)" style="width:100%;margin-top:8px;padding:8px;border-radius:8px;background:#0b1220;border:1px solid #1f2937;color:var(--text)"></textarea>
        <div style="display:flex;gap:8px;margin-top:8px">
          <button id="submitReview" class="review-button" style="flex:1">Submit</button>
        </div>
      </div>
      <div class="review-list" id="reviewList"></div>
    </div>
  </div>
  <script src="/app.js" type="module"></script>
</body>
</html>
